{% extends "ferreteria_base.html" %}

{% block title %}Dashboard - Ferretería El Martillo{% endblock %}

{% block content %}
<div class="dashboard">
    <div class="page-header">
        <h2><i class="fas fa-tachometer-alt"></i> Panel de Control</h2>
        <p>Resumen general del inventario de ferretería</p>
    </div>

    <!-- Estadísticas principales -->
    <div class="stats-grid">
        <div class="stat-card inventory">
            <div class="stat-icon">
                <i class="fas fa-boxes"></i>
            </div>
            <div class="stat-content">
                <h3>Total Productos</h3>
                <p class="stat-number">{{ stats.total_products }}</p>
                <small>{{ stats.total_units }} unidades en stock</small>
            </div>
        </div>

        <div class="stat-card investment">
            <div class="stat-icon">
                <i class="fas fa-dollar-sign"></i>
            </div>
            <div class="stat-content">
                <h3>Inversión Total</h3>
                <p class="stat-number">{{ stats.total_investment | currency }}</p>
                <small>Costo de mercancía</small>
            </div>
        </div>

        <div class="stat-card value">
            <div class="stat-icon">
                <i class="fas fa-chart-line"></i>
            </div>
            <div class="stat-content">
                <h3>Valor de Venta</h3>
                <p class="stat-number">{{ stats.total_value | currency }}</p>
                <small>Precio de venta total</small>
            </div>
        </div>

        <div class="stat-card profit">
            <div class="stat-icon">
                <i class="fas fa-piggy-bank"></i>
            </div>
            <div class="stat-content">
                <h3>Ganancia Potencial</h3>
                <p class="stat-number">{{ stats.potential_profit | currency }}</p>
                <small>{{ stats.total_investment | percentage(stats.total_value) }} margen</small>
            </div>
        </div>

        <div class="stat-card {% if stats.low_stock > 0 %}alert{% endif %}">
            <div class="stat-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="stat-content">
                <h3>Stock Bajo</h3>
                <p class="stat-number">{{ stats.low_stock }}</p>
                <small>Productos por reabastecer</small>
            </div>
        </div>

        <div class="stat-card categories">
            <div class="stat-icon">
                <i class="fas fa-tags"></i>
            </div>
            <div class="stat-content">
                <h3>Categorías</h3>
                <p class="stat-number">{{ stats.categories }}</p>
                <small>Diferentes departamentos</small>
            </div>
        </div>
    </div>

    <!-- Alertas de stock bajo -->
    {% if low_stock_products %}
    <div class="alert-section">
        <h3><i class="fas fa-exclamation-triangle"></i> ¡Atención! Productos con Stock Bajo</h3>
        <div class="alert-products">
            {% for product in low_stock_products %}
            <div class="alert-product">
                <div class="product-info">
                    <strong>{{ product.nombre }}</strong>
                    <span class="product-code">{{ product.codigo or 'Sin código' }}</span>
                </div>
                <div class="stock-info">
                    <span class="current-stock">{{ product.cantidad }}</span>
                    <span class="min-stock">Min: {{ product.stock_minimo }}</span>
                </div>
                <div class="actions">
                    <a href="{{ url_for('editar_producto', product_id=product.id) }}" class="btn btn-sm btn-warning">
                        <i class="fas fa-edit"></i> Actualizar
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="alert-actions">
            <a href="{{ url_for('stock_bajo') }}" class="btn btn-danger">
                <i class="fas fa-list"></i> Ver Todos los Productos con Stock Bajo
            </a>
        </div>
    </div>
    {% endif %}

    <!-- Acciones rápidas -->
    <div class="quick-actions">
        <h3><i class="fas fa-bolt"></i> Acciones Rápidas</h3>
        <div class="action-grid">
            <a href="{{ url_for('nuevo_producto') }}" class="action-card primary">
                <i class="fas fa-plus-circle"></i>
                <h4>Agregar Producto</h4>
                <p>Registrar nuevo artículo en inventario</p>
            </a>
            
            <a href="{{ url_for('buscar') }}" class="action-card secondary">
                <i class="fas fa-search"></i>
                <h4>Buscar Productos</h4>
                <p>Encontrar por código, nombre o categoría</p>
            </a>
            
            <a href="{{ url_for('inventario') }}" class="action-card info">
                <i class="fas fa-warehouse"></i>
                <h4>Ver Inventario Completo</h4>
                <p>Listado completo de productos</p>
            </a>
            
            <a href="{{ url_for('stock_bajo') }}" class="action-card warning">
                <i class="fas fa-exclamation-triangle"></i>
                <h4>Revisar Stock Bajo</h4>
                <p>Productos que necesitan reabastecimiento</p>
            </a>
        </div>
    </div>

    <!-- Productos recientes -->
    {% if recent_products %}
    <div class="recent-section">
        <h3><i class="fas fa-clock"></i> Productos Agregados Recientemente</h3>
        <div class="products-grid">
            {% for product in recent_products %}
            <div class="product-card">
                <div class="product-header">
                    <h4>{{ product.nombre }}</h4>
                    <span class="product-category">{{ product.categoria }}</span>
                </div>
                <div class="product-details">
                    {% if product.codigo %}
                    <p class="product-code"><i class="fas fa-barcode"></i> {{ product.codigo }}</p>
                    {% endif %}
                    {% if product.marca %}
                    <p class="product-brand"><i class="fas fa-copyright"></i> {{ product.marca }}</p>
                    {% endif %}
                    <p class="product-stock">
                        <i class="fas fa-boxes"></i> 
                        Stock: {{ product.cantidad }} {{ product.unidad_medida }}
                    </p>
                    <div class="price-info">
                        <span class="buy-price">Compra: {{ product.precio_compra | currency }}</span>
                        <span class="sell-price">Venta: {{ product.precio_venta | currency }}</span>
                    </div>
                </div>
                <div class="product-actions">
                    <a href="{{ url_for('ver_producto', product_id=product.id) }}" class="btn btn-sm btn-outline">
                        <i class="fas fa-eye"></i> Ver
                    </a>
                    <a href="{{ url_for('editar_producto', product_id=product.id) }}" class="btn btn-sm btn-primary">
                        <i class="fas fa-edit"></i> Editar
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="text-center">
            <a href="{{ url_for('inventario') }}" class="btn btn-outline">
                <i class="fas fa-warehouse"></i> Ver Todo el Inventario
            </a>
        </div>
    </div>
    {% endif %}

    <!-- Resumen por categorías -->
    <div class="categories-summary">
        <h3><i class="fas fa-chart-pie"></i> Resumen por Categorías</h3>
        <div class="category-stats">
            <div class="category-item">
                <i class="fas fa-hammer"></i>
                <span>Herramientas</span>
                <div class="category-bar" style="width: 85%;"></div>
            </div>
            <div class="category-item">
                <i class="fas fa-bolt"></i>
                <span>Electricidad</span>
                <div class="category-bar" style="width: 70%;"></div>
            </div>
            <div class="category-item">
                <i class="fas fa-wrench"></i>
                <span>Plomería</span>
                <div class="category-bar" style="width: 65%;"></div>
            </div>
            <div class="category-item">
                <i class="fas fa-paint-brush"></i>
                <span>Pinturas</span>
                <div class="category-bar" style="width: 60%;"></div>
            </div>
        </div>
    </div>
</div>
{% endblock %}